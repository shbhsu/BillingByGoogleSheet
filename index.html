<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head runat="server">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta charset="UTF-8">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" crossorigin="anonymous">


    <script src="https://code.jquery.com/jquery-1.12.4.js" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" crossorigin="anonymous"></script>


    <script>
        /*! tabletojson */
        !function (a) { "use strict"; a.fn.tableToJSON = function (b) { var c = { ignoreColumns: [], onlyColumns: null, ignoreHiddenRows: !0, ignoreEmptyRows: !1, headings: null, allowHTML: !1, includeRowId: !1, textDataOverride: "data-override", textExtractor: null }; b = a.extend(c, b); var d = function (a) { return void 0 !== a && null !== a }, e = function (c) { return d(b.onlyColumns) ? -1 === a.inArray(c, b.onlyColumns) : -1 !== a.inArray(c, b.ignoreColumns) }, f = function (b, c) { var e = {}, f = 0; return a.each(c, function (a, c) { f < b.length && d(c) && (e[b[f]] = c, f++) }), e }, g = function (c, d, e) { var f = a(d), g = b.textExtractor, h = f.attr(b.textDataOverride); return null === g || e ? a.trim(h || (b.allowHTML ? f.html() : d.textContent || f.text()) || "") : a.isFunction(g) ? a.trim(h || g(c, f)) : "object" == typeof g && a.isFunction(g[c]) ? a.trim(h || g[c](c, f)) : a.trim(h || (b.allowHTML ? f.html() : d.textContent || f.text()) || "") }, h = function (c, d) { var e = [], f = b.includeRowId, h = "boolean" == typeof f ? f : "string" == typeof f ? !0 : !1, i = "string" == typeof f == !0 ? f : "rowId"; return h && "undefined" == typeof a(c).attr("id") && e.push(i), a(c).children("td,th").each(function (a, b) { e.push(g(a, b, d)) }), e }, i = function (a) { var c = a.find("tr:first").first(); return d(b.headings) ? b.headings : h(c, !0) }, j = function (c, h) { var i, j, k, l, m, n, o, p = [], q = 0, r = []; return c.children("tbody,*").children("tr").each(function (c, e) { if (c > 0 || d(b.headings)) { var f = b.includeRowId, h = "boolean" == typeof f ? f : "string" == typeof f ? !0 : !1; n = a(e); var r = n.find("td").length === n.find("td:empty").length ? !0 : !1; !n.is(":visible") && b.ignoreHiddenRows || r && b.ignoreEmptyRows || n.data("ignore") && "false" !== n.data("ignore") || (q = 0, p[c] || (p[c] = []), h && (q += 1, "undefined" != typeof n.attr("id") ? p[c].push(n.attr("id")) : p[c].push("")), n.children().each(function () { for (o = a(this); p[c][q];)q++; if (o.filter("[rowspan]").length) for (k = parseInt(o.attr("rowspan"), 10) - 1, m = g(q, o), i = 1; k >= i; i++)p[c + i] || (p[c + i] = []), p[c + i][q] = m; if (o.filter("[colspan]").length) for (k = parseInt(o.attr("colspan"), 10) - 1, m = g(q, o), i = 1; k >= i; i++)if (o.filter("[rowspan]").length) for (l = parseInt(o.attr("rowspan"), 10), j = 0; l > j; j++)p[c + j][q + i] = m; else p[c][q + i] = m; m = p[c][q] || g(q, o), d(m) && (p[c][q] = m), q++ })) } }), a.each(p, function (c, g) { if (d(g)) { var i = d(b.onlyColumns) || b.ignoreColumns.length ? a.grep(g, function (a, b) { return !e(b) }) : g, j = d(b.headings) ? h : a.grep(h, function (a, b) { return !e(b) }); m = f(j, i), r[r.length] = m } }), r }, k = i(this); return j(this, k) } }(jQuery);

    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/6.0.4/highcharts.js"></script>


    <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" crossorigin="anonymous">
    <script>

        function getParameterByName(name, url) {
            if (!url)
          
            return 
        }

        var googleURL = '';

        function makeHttpObject() {
            try {
                var url = window.location.href;
                googleURL = decodeURIComponent((url.substring(url.indexOf("googleURL"),url.length)).replace("googleURL=",""));
                console.log(googleURL)
                return new XMLHttpRequest();

            }
            catch (error) { }
            try { return new ActiveXObject("Msxml2.XMLHTTP"); }
            catch (error) { }
            try { return new ActiveXObject("Microsoft.XMLHTTP"); }
            catch (error) { }

            throw new Error("Could not create HTTP request object.");
        }
        var request = makeHttpObject();
        request.open("GET", googleURL, true);
        request.send(null);

        var tableHTML = '';
        var table = '';
        var chartSeries = [];
        var total;

        request.onreadystatechange = function () {
            if (request.readyState == 4)

                tableHTML = (request.responseText).substring(request.responseText.indexOf("<table"), request.responseText.indexOf("</table")) + "</table>";
            var thead = tableHTML.substring(tableHTML.indexOf("<tr"), tableHTML.indexOf("</tr")) + "</tr>";
            tableHTML = tableHTML.replace(thead, "");
            tableHTML = tableHTML.replace(" cellspacing=\"0\">", " cellspacing='0'><thead>" + thead + "</thead>");


            $('#tableList').html(tableHTML.replace("<table", "<table id='TableResult' class='table table- striped' width='100%' "));




            var $table = $('#TableResult');

            table = $table.tableToJSON();
            var newTable = $.map(table, function (e) {
                return (e.FirstName == "日期") ? null : e;
            });

            var grphDates = new Array();
            var groupedObjects = new Array();
            $.each(table, function (ix, obj) {
                var existingObj;
                if ($.inArray(obj.項目, grphDates) >= 0) {
                    // Get index of existing object width date == obj.Date
                    var index = groupedObjects.map(function (o, i) {
                        if (o.項目 == obj.項目) return i;
                    }).filter(isFinite);

                    groupedObjects[index].金額 = (parseInt(groupedObjects[index].金額 || 0) + parseInt(obj.金額)).toString();

                } else {
                    groupedObjects.push(obj);
                    grphDates.push(obj.項目);

                }


            });

            $.each(groupedObjects, function (ix, obj) {
                total = (parseInt(total) || 0) + (parseInt(obj.金額));
                var obj = { name: obj.項目, y: parseInt(obj.金額) };
                chartSeries.push(obj);
            })
            $('#totalShow').html('總計:' + total);


            $('#Costcontainer').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: '綜合支出統計圖 '
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.y}</b>'
                },
                credits: {
                    enabled: false
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            enabled: true

                        },
                        showInLegend: true
                    }
                },
                series: [{
                    name: '$',
                    colorByPoint: true,
                    data: chartSeries
                }]
            });


            $('#TableResult').DataTable();
        };






    </script>


    <script type="text/javascript">
        $(function () {
            // 預設顯示第一個 Tab
            var _showTab = '0';
            $('.Rabgne_tab').each(function () {
                // 目前的頁籤區塊
                var $tab = $(this);

                var $defaultLi = $('ul.nav-tabs li', $tab).eq(_showTab).addClass('active');
                $($defaultLi.find('a').attr('href')).siblings().hide();

                // 當 li 頁籤被點擊時...
                // 若要改成滑鼠移到 li 頁籤就切換時, 把 click 改成 mouseover
                $('ul.nav-tabs li', $tab).click(function () {



                    // 找出 li 中的超連結 href(#id)
                    var $this = $(this),
                        _clickTab = $this.find('a').attr('href');


                    // 把目前點擊到的 li 頁籤加上 .active
                    // 並把兄弟元素中有 .active 的都移除 class
                    $this.addClass('active').siblings('.active').removeClass('active');
                    // 淡入相對應的內容並隱藏兄弟元素
                    $(_clickTab).stop(false, true).fadeIn().siblings().hide();
                    $(window).resize();//重製大小

                    return false;

                }).find('a').focus(function () {
                    this.blur();
                });

            });

        });



    </script>



</head>

<body>
    <main role="main">


        <div class="container">

            <hr />
            <div class="Rabgne_tab">

                <ul class="nav nav-tabs">
                    <li>
                        <a href="#Rtab1">支出明細</a>
                    </li>
                    <li>
                        <a href="#Rtab2">支出統計圖</a>
                    </li>

                </ul>

                <div class="tab_container" style="border-style: double; border-color: #c5d0dc;">


                    <div id="Rtab2" class="tab_content">
                        <div id="Costcontainer" style="height: 600px; margin: 0 auto; padding-top: 80px;"></div>


                    </div>


                    <div id="Rtab1" class="tab_content">
                        <div class="row" style="padding: 20px;">
                            <div class="col-xs-12 col-sm-12 col-md-12">

                                <div style="text-align: right; font-size: 20px; font-weight: bold;">
                                    <div id="totalShow"></div>
                                </div>
                                <hr />
                                <div id="tableList"></div>

                                <hr />


                            </div>



                        </div>

                    </div>
                </div>



            </div>




            <hr />

        </div>
        <!-- /container -->

    </main>





</body>

</html>